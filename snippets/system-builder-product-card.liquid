{%- comment -%}
  System Builder Product Card (server-side rendered)
  Used for static accessory panels: balls and pineapples.

  Required parameters:
  - product:      The Shopify product object
  - product_type: Type string — 'ball' or 'pineapple'
  - group:        Group string — 'balls' or 'pineapples'
  - index:        0-based integer index within the group

  Optional parameters:
  - variant:  A specific variant to render. Falls back to selected_or_first_available_variant.
  - selected: Boolean, whether the card starts pre-selected (default false)
{%- endcomment -%}


{%- if product != blank -%}
  {%- unless variant -%}
    {%- assign variant = product.selected_or_first_available_variant -%}
  {%- endunless -%}

  {%- comment -%} Show variant name only when it's meaningful (not 'Default Title') {%- endcomment -%}
  {%- if variant.title != 'Default Title' -%}
    {%- assign card_title = product.title | append: ' — ' | append: variant.title -%}
  {%- else -%}
    {%- assign card_title = product.title -%}
  {%- endif -%}

  {%- comment -%} Prefer the variant-specific image so each colour shows its own photo {%- endcomment -%}
  {%- assign card_image = variant.image | default: product.featured_image -%}

  {%- comment -%} Pre-order: tracked, out of stock, but continues selling {%- endcomment -%}
  {%- assign is_preorder = false -%}
  {%- if variant.inventory_management == 'shopify' and variant.inventory_quantity <= 0 and variant.inventory_policy == 'continue' -%}
    {%- assign is_preorder = true -%}
  {%- endif -%}

  <div class="system-builder__product-card{% if selected %} system-builder__product-card--selected{% endif %}"
       data-product-card
       data-product-type="{{ product_type }}"
       data-product-group="{{ group }}"
       data-product-index="{{ index }}"
       data-price="{{ variant.price }}"
       role="button"
       tabindex="0"
       aria-pressed="{{ selected | default: false }}"
       aria-label="{% if selected %}Remove from{% else %}Add to{% endif %} your system: {{ card_title | escape }}">
    <div class="system-builder__product-select-indicator">
      <span class="system-builder__checkmark"></span>
    </div>
    {%- if is_preorder -%}
      <div class="system-builder__badge system-builder__badge--preorder">Pre-Order</div>
    {%- endif -%}
    <div class="system-builder__product-image">
      {%- if card_image != blank -%}
        {{ card_image | image_url: width: 200 | image_tag: loading: 'lazy', class: 'system-builder__product-img' }}
      {%- else -%}
        <div class="system-builder__product-placeholder-image"></div>
      {%- endif -%}
    </div>
    <div class="system-builder__product-info">
      <h4 class="system-builder__product-title">{{ card_title }}</h4>
      <p class="system-builder__product-price">{{ variant.price | money }}</p>
    </div>
    <input type="hidden" name="variant_id" value="{{ variant.id }}" data-variant-id>
  </div>
{%- endif -%}
